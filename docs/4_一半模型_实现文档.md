# 一半模型页面实现文档

## 概述

本页面实现了一半模型的交互式学习功能。一半模型是几何中的重要概念，描述了三角形与平行四边形之间的面积关系：等底等高的三角形面积是平行四边形面积的一半。通过动态演示和计算验证，帮助用户深入理解这一重要几何关系。

## 功能特性

### 核心功能
- **面积关系演示**: 展示三角形与平行四边形的面积关系
- **动态参数调整**: 通过滑块调整底边长度和高度
- **实时计算验证**: 即时验证面积关系的正确性
- **多种图形展示**: 提供不同视角的图形演示

### 交互功能
- 滑块调整底边和高度参数
- 实时显示面积计算结果
- 动态更新图形展示
- 支持图形对比和导出

## 技术实现

### 文件结构
```
pages/4_一半模型.py
├── 导入模块
├── 字体配置
├── 页面配置
├── 绘图函数
├── 一半模型演示
├── 面积关系验证
└── 应用示例
```

### 核心算法

#### 1. 面积计算
```python
def calculate_parallelogram_area(base, height):
    """
    计算平行四边形面积。
    
    公式：面积 = 底边 × 高
    
    Args:
        base: 底边长度
        height: 高（垂直于底边的距离）
    
    Returns:
        float: 平行四边形面积
    """
    return base * height

def calculate_triangle_area(base, height):
    """
    计算三角形面积。
    
    公式：面积 = (底边 × 高) / 2
    
    Args:
        base: 底边长度
        height: 高（垂直于底边的距离）
    
    Returns:
        float: 三角形面积
    """
    return 0.5 * base * height

def verify_half_model(base, height):
    """
    验证一半模型的正确性。
    
    Args:
        base: 底边长度
        height: 高度
    
    Returns:
        dict: 验证结果和面积信息
    """
    parallelogram_area = calculate_parallelogram_area(base, height)
    triangle_area = calculate_triangle_area(base, height)
    
    # 验证三角形面积是否为平行四边形面积的一半
    expected_triangle_area = parallelogram_area / 2
    is_valid = abs(triangle_area - expected_triangle_area) < 1e-6
    
    return {
        "is_valid": is_valid,
        "parallelogram_area": parallelogram_area,
        "triangle_area": triangle_area,
        "ratio": triangle_area / parallelogram_area if parallelogram_area != 0 else 0
    }
```

#### 2. 图形生成
```python
def generate_parallelogram_and_triangle(base, height, angle=60):
    """
    生成平行四边形和对应的三角形。
    
    Args:
        base: 底边长度
        height: 高度
        angle: 平行四边形的内角（度）
    
    Returns:
        dict: 包含平行四边形和三角形的顶点坐标
    """
    # 将角度转换为弧度
    angle_rad = np.radians(angle)
    
    # 计算平行四边形的顶点
    # 左下角顶点在原点
    A = (0, 0)
    B = (base, 0)
    
    # 计算平行四边形的边向量
    side_length = height / np.sin(angle_rad)
    D = (side_length * np.cos(angle_rad), height)
    C = (base + side_length * np.cos(angle_rad), height)
    
    # 计算三角形的顶点（使用平行四边形的一半）
    # 选择对角线形成的三角形
    triangle_vertices = [A, B, C]
    
    return {
        'parallelogram': [A, B, C, D],
        'triangle': triangle_vertices,
        'base': base,
        'height': height,
        'angle': angle
    }
```

#### 3. 一半模型可视化
```python
def draw_half_model_comparison(base, height, angle=60):
    """
    绘制一半模型的对比图。
    
    Args:
        base: 底边长度
        height: 高度
        angle: 平行四边形的内角（度）
    
    Returns:
        matplotlib.figure.Figure: 绘制的图形对象
    """
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 8))
    
    # 生成图形数据
    data = generate_parallelogram_and_triangle(base, height, angle)
    
    # 计算面积
    parallelogram_area = calculate_parallelogram_area(base, height)
    triangle_area = calculate_triangle_area(base, height)
    
    # 绘制平行四边形
    parallelogram = Polygon(data['parallelogram'], 
                           fill=True, alpha=0.7, color='lightblue')
    ax1.add_patch(parallelogram)
    
    # 添加标签
    ax1.text(base/2, -height*0.2, f'底边 = {base}', ha='center', fontsize=12)
    ax1.text(-0.5, height/2, f'高 = {height}', 
             ha='center', va='center', fontsize=12, rotation=90)
    ax1.text(base/2, height/2, f'面积 = {parallelogram_area:.2f}', 
             ha='center', fontsize=12, weight='bold')
    
    # 绘制三角形
    triangle = Polygon(data['triangle'], 
                      fill=True, alpha=0.7, color='lightcoral')
    ax2.add_patch(triangle)
    
    # 添加标签
    ax2.text(base/2, -height*0.2, f'底边 = {base}', ha='center', fontsize=12)
    ax2.text(base/2, height/2, f'面积 = {triangle_area:.2f}', 
             ha='center', fontsize=12, weight='bold')
    
    # 添加对角线（在平行四边形图中）
    vertices = np.array(data['parallelogram'])
    ax1.plot([vertices[0, 0], vertices[2, 0]], 
             [vertices[0, 1], vertices[2, 1]], 
             'r--', linewidth=2, label='对角线')
    ax1.plot([vertices[1, 0], vertices[3, 0]], 
             [vertices[1, 1], vertices[3, 1]], 
             'r--', linewidth=2)
    
    # 设置坐标轴
    margin = max(base, height) * 0.2
    for ax in [ax1, ax2]:
        ax.set_xlim(-margin, base + margin + height/np.tan(np.radians(angle)))
        ax.set_ylim(-margin, height + margin)
        ax.set_aspect('equal')
        ax.grid(True, alpha=0.3)
    
    ax1.set_title(f'平行四边形：面积 = {parallelogram_area:.2f}', fontsize=14)
    ax2.set_title(f'三角形：面积 = {triangle_area:.2f}（平行四边形的一半）', 
                  fontsize=14)
    
    # 添加整体标题
    fig.suptitle('一半模型：等底等高的三角形面积是平行四边形的一半', 
                 fontsize=16, y=0.98)
    
    return fig
```

#### 4. 一半模型数学原理
```python
def explain_half_model_principle():
    """
    解释一半模型的数学原理。
    
    Returns:
        dict: 包含原理说明和公式
    """
    return {
        "principle": """
        一半模型：等底等高的三角形面积是平行四边形面积的一半。
        
        数学原理：
        1. 平行四边形可以看作是两个全等的三角形组成
        2. 通过平行四边形的对角线，可以将其分割成两个面积相等的三角形
        3. 每个三角形的面积就是平行四边形面积的一半
        
        这个性质对于任何平行四边形和对应的三角形都成立。
        """,
        "formula": "S_三角形 = ½ × S_平行四边形 (当底和高相等时)",
        "proof": """
        证明：
        1. 设平行四边形的底为b，高为h
        2. 平行四边形面积 = b × h
        3. 三角形面积 = ½ × b × h
        4. 因此：S_三角形 = ½ × S_平行四边形
        """,
        "applications": [
            "计算复杂图形的面积",
            "解决几何证明问题",
            "工程测量中的面积计算",
            "土地面积分割",
            "建筑设计中的面积估算"
        ]
    }
```

### 页面布局设计

#### 1. 主界面结构
```python
def main():
    """一半模型页面的主函数。"""
    
    # 页面标题和介绍
    st.title("🔺 一半模型")
    st.markdown("学习等底等高的三角形与平行四边形的面积关系")
    
    # 创建控制面板
    st.sidebar.header("参数调整")
    
    base = st.sidebar.slider("底边长度", 
                           min_value=1.0, max_value=10.0, value=5.0, step=0.5)
    height = st.sidebar.slider("高度", 
                            min_value=1.0, max_value=8.0, value=4.0, step=0.5)
    angle = st.sidebar.slider("平行四边形角度", 
                             min_value=30, max_value=150, value=60, step=15)
    
    # 计算面积
    parallelogram_area = calculate_parallelogram_area(base, height)
    triangle_area = calculate_triangle_area(base, height)
    
    # 验证结果
    verification = verify_half_model(base, height)
    
    # 显示计算结果
    col1, col2, col3 = st.columns(3)
    
    with col1:
        st.metric("平行四边形面积", f"{parallelogram_area:.2f}")
    with col2:
        st.metric("三角形面积", f"{triangle_area:.2f}")
    with col3:
        if verification["is_valid"]:
            st.success("✅ 验证成功")
        else:
            st.error("❌ 验证失败")
    
    # 创建选项卡
    tab1, tab2, tab3 = st.tabs(["一半模型演示", "数学原理", "应用实例"])
    
    with tab1:
        show_half_model_demo(base, height, angle)
    
    with tab2:
        show_mathematical_principle()
    
    with tab3:
        show_practical_examples()
```

#### 2. 一半模型演示
```python
def show_half_model_demo(base, height, angle):
    """展示一半模型的演示。"""
    
    st.subheader("等底等高面积关系")
    
    # 绘制对比图
    fig = draw_half_model_comparison(base, height, angle)
    st.pyplot(fig)
    
    # 数学验证
    st.subheader("数学验证")
    
    col1, col2 = st.columns(2)
    
    with col1:
        st.latex(f"S_平行四边形 = {base} \times {height} = {base * height:.2f}")
    
    with col2:
        st.latex(f"S_三角形 = \frac{{{base} \times {height}}}{{2}} = {base * height / 2:.2f}")
    
    st.latex(f"\frac{{S_三角形}}{{S_平行四边形}} = \frac{{{base * height / 2:.2f}}}{{{base * height:.2f}}} = \frac{{1}}{{2}}")
```

#### 3. 数学原理展示
```python
def show_mathematical_principle():
    """展示一半模型的数学原理。"""
    
    st.subheader("一半模型数学原理")
    
    # 原理说明
    principle = explain_half_model_principle()
    
    st.markdown(principle["principle"])
    
    # 公式展示
    st.latex(principle["formula"])
    
    # 证明过程
    st.subheader("证明过程")
    st.markdown(principle["proof"])
    
    # 应用场景
    st.subheader("应用场景")
    for app in principle["applications"]:
        st.write(f"• {app}")
```

#### 4. 应用实例
```python
def show_practical_examples():
    """展示一半模型的实际应用。"""
    
    st.subheader("实际应用案例")
    
    # 案例1：土地测量
    st.write("**案例1：土地面积计算**")
    st.info("""
    一块平行四边形土地，底边长100米，高50米，总面积为5000平方米。
    现在需要计算其中三角形部分的面积。
    
    使用一半模型：
    - 平行四边形面积 = 100 × 50 = 5000平方米
    - 三角形面积 = 5000 / 2 = 2500平方米
    """)
    
    # 案例2：屋顶设计
    st.write("**案例2：屋顶材料计算**")
    st.info("""
    一个平行四边形屋顶，底边长8米，高3米，总面积为24平方米。
    如果采用三角形瓦片，每个瓦片覆盖面积为屋顶的一半。
    
    计算：
    - 需要瓦片面积 = 24 / 2 = 12平方米
    """)
    
    # 案例3：图形分割
    st.write("**案例3：复杂图形分割**")
    st.info("""
    一个复杂的四边形可以分割成两个三角形，如果这两个三角形具有相同的底边和高度，
    那么它们的面积相等，都是对应平行四边形面积的一半。
    """)
```

## 数学原理

### 一半模型基本定理

#### 定理陈述
等底等高的三角形面积是平行四边形面积的一半。

#### 数学表达
$$S_{三角形} = \frac{1}{2} \times S_{平行四边形}$$

#### 证明
**几何证明**：
1. 平行四边形ABCD，底边AB = b，高 = h
2. 连接对角线AC，将平行四边形分成两个全等的三角形ABC和ADC
3. 每个三角形的面积 = ½ × b × h
4. 平行四边形面积 = b × h
5. 因此：S_三角形 = ½ × S_平行四边形

**代数证明**：
1. 设平行四边形面积为S_p = b × h
2. 三角形面积为S_t = ½ × b × h
3. 显然：S_t = ½ × S_p

### 推广定理

#### 一般情况
对于任意平行四边形和对应的三角形：
- 如果三角形和平行四边形具有相同的底边和高度，则三角形面积总是平行四边形面积的一半
- 这个性质与平行四边形的具体形状无关

#### 应用场景
1. **面积计算**: 简化复杂图形的面积计算
2. **图形分割**: 将复杂图形分割为简单的三角形
3. **比例关系**: 建立不同图形间的面积比例关系

## 性能优化

### 计算优化
- 使用NumPy进行高效的数学运算
- 缓存计算结果避免重复计算
- 使用向量化操作处理批量数据

### 可视化优化
- 使用合适的图形尺寸和比例
- 优化颜色方案提高可读性
- 减少不必要的图形重绘

## 测试用例

### 基本验证
```python
test_cases = [
    {"base": 4, "height": 3, 
     "expected_parallelogram": 12, "expected_triangle": 6},
    {"base": 5, "height": 4, 
     "expected_parallelogram": 20, "expected_triangle": 10},
    {"base": 10, "height": 2.5, 
     "expected_parallelogram": 25, "expected_triangle": 12.5},
]
```

### 边界测试
```python
edge_cases = [
    {"base": 0, "height": 5, "expected_error": "底边不能为零"},
    {"base": 2, "height": 0, "expected_areas": [0, 0]},
    {"base": 1e-10, "height": 1e-10, 
     "expected_parallelogram": 1e-20, "expected_triangle": 0.5e-20},
]
```

## 扩展功能

### 未来改进
1. **任意四边形**: 支持任意四边形与三角形的面积关系
2. **3D扩展**: 扩展到三维空间中的体积关系
3. **动画演示**: 展示图形变换过程中的面积关系
4. **批量处理**: 支持多个图形的同时计算

### 高级功能
1. **误差分析**: 分析测量误差对结果的影响
2. **单位换算**: 支持不同长度单位的换算
3. **图形识别**: 自动识别平行四边形和三角形
4. **报告生成**: 自动生成计算报告

## 相关文档

- [三角形分类页面实现文档](1_三角形分类_实现文档.md)
- [勾股定理页面实现文档](2_勾股定理_实现文档.md)
- [等高模型页面实现文档](3_等高模型_实现文档.md)
- [燕尾模型页面实现文档](5_燕尾模型_实现文档.md)

---

*文档创建时间：2024年*  
*最后更新：2024年*